<html>
<head>
  <title>Bugku Misc 10（61-）</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/602628 (zh-CN, DDL); Windows/6.1.1 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="3074"/>
<h1>Bugku Misc 10（61-）</h1>

<div>
<span><div><span style="font-weight: bold;">61 ping</span></div><div><br/></div><div>下载得到pcap格式文件，wireshark打开，共有38个数据包，均为ICMP协议：</div><div><img src="Bugku Misc 10（61-）_files/Image.png" type="image/png" data-filename="Image.png"/></div><div>每个包的数据长度均为1400，除第1字节外后续字节均为0a和大量00：</div><div><img src="Bugku Misc 10（61-）_files/Image [1].png" type="image/png" data-filename="Image.png"/></div><div>依次查看每个数据包，数据段第1字节依次为f、l、a、g、{，显然拼接后就能得到flag。练习一下tshark命令：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop# tshark -r ping.pcap -Y &quot;icmp&quot; -T fields -e data | cut -c1-2 | xargs</div><div>Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</div><div>66 6c 61 67 7b 64 63 37 36 61 31 65 65 65 36 65 33 38 32 32 38 37 37 65 64 36 32 37 65 30 61 30 34 61 62 34 61 7d</div></div><div>十六进制ASCII转码得到flag。</div><div><br/></div><div>flag：flag{dc76a1eee6e3822877ed627e0a04ab4a}</div><div><br/></div><div><span style="font-weight: bold;">62 baby_misc</span></div><div><br/></div><div>下载得到zip格式文件，压缩包内含三个文件：</div><div><img src="Bugku Misc 10（61-）_files/Image [2].png" type="image/png" data-filename="Image.png"/></div><div>其中zip是加密压缩包，txt是追加提示，先看jpg格式文件。十六进制编辑器打开：</div><div><img src="Bugku Misc 10（61-）_files/Image [3].png" type="image/png" data-filename="Image.png"/></div><div>看到IHDR和IDAT等块头部标识，说明这是一个PNG格式图像，文件头被改成了JPG格式文件头。将其修复：</div><div><img src="Bugku Misc 10（61-）_files/Image [4].png" type="image/png" data-filename="Image.png"/></div><div>同时发现文件尾后有额外数据，是另一张PNG格式图片：</div><div><img src="Bugku Misc 10（61-）_files/Image [5].png" type="image/png" data-filename="Image.png"/></div><div>用foremost分离，得到两张PNG格式图片：</div><div><img src="Bugku Misc 10（61-）_files/Image [6].png" type="image/png" data-filename="Image.png"/></div><div>用Stegsolve的Image Combiner功能比较两图，SUB模式的结果中有大量横向虚线样图案：</div><div><img src="Bugku Misc 10（61-）_files/Image [7].png" type="image/png" data-filename="Image.png"/></div><div>说明是盲水印，根据提示，直接用盲水印工具处理：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>root@kali:~/Desktop/blind-watermark-python3/BlindWaterMark# python3 bwmforpy3.py decode 00000000.png 00000657.png out.png</div></div><div><img src="Bugku Misc 10（61-）_files/out.png" type="image/png" data-filename="out.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>passwd:wowblind</div></div><div><br/></div><div>解压 看到flag了.zip ，得到flag.zip和password.txt，前者是加密压缩包，先看后者：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>萌新专属RSA：</div><div>已知R=65537</div><div>N=21321423135312411313</div><div>求出来十进制d就是解压密码</div></div><div>直接上工具吧，RSA-Tool 2：</div><div><img src="Bugku Misc 10（61-）_files/Image [8].png" type="image/png" data-filename="Image.png"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>1653347504416359113</div></div><div>解压flag.zip得到flag.txt：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>NGZlbmNl</div><div>eW91IG5lZWR+</div><div>VGhhbmsgeW91</div><div>Zm9yIGJlaW5n</div><div>YWJsZSB0b4++</div><div>ZG8gdGhpc5++</div><div>c3RlcC6+</div><div>VGhlIGRpZmZpY3VsdGllc3++</div><div>YWhlYWQgc2hvdWxk</div><div>bm90IGJlIGRpZmZpY3VsdH++</div><div>Zm9yIHRob3Nl</div><div>d2hvIGNhbk++</div><div>ZG8ndGhpcyBzdGVwLn++</div><div>Tm93IGl0J3MgSmFudWFyeV++</div><div>MTUgb2YgdGhl</div><div>MjFzdCB5ZWFyLn++</div><div>SWYgeW91IGFyZb++</div><div>bHVja3kgZW5vdWdo</div><div>dG8gc2VlIHRoZT++</div><div>d2hvbGUgcGFzc2FnZQ++</div><div>YmVmb3JlIHRoZW++</div><div>bmV3IHllYXIs</div><div>SSB3aXNoIHlvdT++</div><div>YSBoYXBweW++</div><div>bmV3JHllYXJ+</div><div>aW6gYWR2YW5jZS6+</div><div>SW4gYWRkaXRpb24s</div><div>SSB3aWxsIHdyaXRl</div><div>YSBxdWVzdGlvbiBhYm91dG++</div><div>c29jaWFsIGVuZ2luZWVyaW5n</div><div>b24nYnVna3Und2hlbn++</div><div>dGhlIG5ldyB5ZWFy</div><div>aXMnY29taW5nLn++</div><div>SSBob3BlIHlvdV++</div><div>aGF2ZSBh</div><div>Z29vZCB0aW1l</div><div>QnkgdGhlIHdheSx+</div><div>SSdtIGErbmV3IENURmVyLr++</div><div>SSBhbHNv</div><div>d2FudCB0b9++</div><div>d29yayBzaWRlIGJ5</div><div>c2lkZSB3aXRo</div><div>dGhlIGRhbGFvLn++</div><div>SSBjYW1lIGludG8g</div><div>Y29udGFjdCB3aXRo</div><div>c1RGIHdoZW4gSc++</div><div>d2VudCB0byB0aGX+</div><div>Q29sbGVnZSBpbiAyMDIwLj++</div><div>SSBob3BlIHdl</div><div>Y2FuIGFsbH++</div><div>d29yayB0b2dldGhlct++</div><div>SSB3b25kZXJ+</div><div>aWYgc29tZW9uZSB3aWxsIK++</div><div>cmVhbGx5IHRyYW5zbGF0ZSD+</div><div>dGhpcyBwYXNzYWdl</div><div>YW5kIGVpZ2h0IGdvZG++</div><div>dGhpbmsgaXQgaXN+</div><div>dGhlIGVhc2llc3Q+</div><div>bWlzYyBxdWVzdGlvbn++</div><div>Zm9yIGhl</div><div>YnVna3U2Ni++</div></div><div>尝试一下可以发现两条线索：</div><div>1、将所有+改为=后，每行都是base64编码；</div><div>2、上述末尾带=的行，base64解码后再次编码，末尾字符有所不同。</div><div>从而可以判定是base64隐写，用脚本提取隐写信息：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>import re</div><div>import base64</div><div><br/></div><div>b64chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</div><div><br/></div><div>f = open('base!.txt','r')</div><div>base64str = f.readline()</div><div><br/></div><div>pattern2 = r'(\S)==$'</div><div>pattern1 = r'(\S)=$'</div><div><br/></div><div>binstring = ''</div><div><br/></div><div>while(base64str):</div><div>    if re.compile(pattern2).findall(base64str):</div><div>        mstr = re.compile(pattern2).findall(base64str)[0]</div><div>        mbin = bin(b64chars.find(mstr))</div><div>        mbin2 = mbin[0:2] + mbin[2:].zfill(6)</div><div>        stegobin = mbin2[-4:]</div><div>        binstring += stegobin</div><div>    elif re.compile(pattern1).findall(base64str):</div><div>        mstr = re.compile(pattern1).findall(base64str)[0]</div><div>        mbin = bin(b64chars.find(mstr))</div><div>        mbin2 = mbin[0:2] + mbin[2:].zfill(6)</div><div>        stegobin = mbin2[-2:]</div><div>        binstring += stegobin</div><div>    base64str = f.readline()</div><div>for i in range(0,len(binstring),8):</div><div>    print(chr(int(binstring[i:i+8],2)),end='')</div></div><div>运行结果：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bgtu{0cfguo_3}kdr</div></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">很明显是栅栏密码，W形栅栏解密，栏数为4，得到：</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>bugku{g0od_ctf3r}</div></div><div><br/></div><div>flag：Bugku{g0od_ctf3r}</div></span>
</div></body></html> 